var excludedGrids=[],changes_params={},need_to_notify=!1,need_to_inform=!1,is_saving=!1,onmousedownValue=null,onmousemoveValue=null,already_selected=!1,notify_user="",position_recalculated=!1,expandTimeout=null,expanded=!0,grid_selected_rows_cache={},GridsOnAfterValueChangedFunction={},GridsOnValueChangedFunction={},GridsSelectAll={};function validateCode(e){return e instanceof $||(e=$(e)),""!==e.val().replace(/([A-Za-ząčęėįšųūž0-9\s]*)/i,"")?($(e).addClass("fill-in"),!1):($(e).removeClass("fill-in"),!0)}function addGridEvents(){if(typeof GetGrids!=typeof Function)return!1;GetGrids();var e={};if(void 0!==Grids.OnAfterValueChanged&&$.isFunction(Grids.OnAfterValueChanged)||(Grids.OnAfterValueChanged=function(e,t,i,a){"function"==typeof GridsOnAfterValueChangedFunction[e.id]&&GridsOnAfterValueChangedFunction[e.id](e,t,i,a)}),void 0!==Grids.OnValueChanged&&$.isFunction(Grids.OnValueChanged)||(Grids.OnValueChanged=function(e,t,i,a){return"function"==typeof GridsOnValueChangedFunction[e.id]?GridsOnValueChangedFunction[e.id](e,t,i,a):a}),void 0!==Grids.OnRowDelete&&$.isFunction(Grids.OnRowDelete)||(Grids.OnRowDelete=function(t,i){if(0===i.CanDelete&&(t.SetAttribute(i,null,"Deleted",0,1),i.parent_id&&i.parent_id>0))for(;i.parentNode&&"Data"==i.parentNode.Kind;)void 0!==i.parentNode.CanDelete&&1!==i.parentNode.CanDelete||e[i.parentNode.id]||(e[i.parentNode.id]=i.parentNode),i=i.parentNode;"task_work_grid"!=t.id&&"task_material_grid"!=t.id||!i.Added||(t.RemoveRow(i),"function"==typeof checkCanTransferForFactApproval&&checkCanTransferForFactApproval())}),void 0!==Grids.OnSave&&$.isFunction(Grids.OnSave)||(Grids.OnSave=function(t){if(!is_saving){var i=t.id;if("user,substitution"==(i=i.split("_",2))){is_saving=!0;for(var a=document.getElementsByClassName(" GSCellSpaceButton GSToolSave GSEmpty"),n=0;n<a.length;n++)onmousedownValue=a[n].getAttribute("onmousedown"),onmousemoveValue=a[n].getAttribute("onmousemove"),a[n].removeAttribute("onmousedown"),a[n].removeAttribute("onmousemove");t.Disable()}for(n in 0==$(".ui-pnotify-container.alert-info").length&&showMessage(_TRANSLATIONS.SAVING,"info-message"),e){var o=e[n];t.SetAttribute(o,null,"Deleted",0,1),t.AcceptChanges(o)}e={}}}),void 0!==Grids.OnTip&&$.isFunction(Grids.OnTip)||(Grids.OnTip=function(e,t,i,a){var n=e.id;return(n.search("billing-project-billing-grid-")>=0||"material_order_list"==n||"equipment_order_list"==n)&&"Panel"==i&&"COMMENT_COMMENTS"==a?t.comment:a}),void 0!==Grids.OnDataSend&&$.isFunction(Grids.OnDataSend)||(Grids.OnDataSend=function(e,t,i,a){showLoader()}),void 0!==Grids.OnRenderPageFinish&&$.isFunction(Grids.OnRenderPageFinish)||(Grids.OnRenderPageFinish=function(e,t){hideLoader()}),void 0!==Grids.OnFilterFinish&&$.isFunction(Grids.OnFilterFinish)||(Grids.OnFilterFinish=function(e,t){hideLoader()}),void 0!==Grids.OnReady&&$.isFunction(Grids.OnReady)||(Grids.OnReady=function(e,t){hideLoader(),clearGridCacheSelectedRows(e),delete GridsSelectAll[e.id]}),void 0!==Grids.OnRowAdd&&$.isFunction(Grids.OnRowAdd)||(Grids.OnRowAdd=function(e,t){"production_project_part_grid"==e.id||"production_project_part_grid_popup"==e.id?(e.Focus(t,"name",null,!0),e.StartEdit()):"production_project_gantt"==e.id&&"function"==typeof ganttGridRowAdd&&ganttGridRowAdd(e,t)}),void 0!==Grids.OnDataGet&&$.isFunction(Grids.OnDataGet)||(Grids.OnDataGet=function(e,t,i,a){$("#filter_button").attr("disabled")&&$("#filter_button").removeAttr("disabled"),hideLoader(),"1"===a.user_logged_out&&("window.location"===a.callback_function?window.location.replace(a.location):window.location.reload()),a.sequencecard_operaction_deleted&&$("#operation-edit-container").html("")}),void 0!==Grids.OnShowMessage&&$.isFunction(Grids.OnShowMessage)||(Grids.OnShowMessage=function(e,t){hideLoader()}),void 0!==Grids.OnRenderFinish&&$.isFunction(Grids.OnRenderFinish)||(Grids.OnRenderFinish=function(e){if(hideLoader(),e.id===$("#gantt_id").val())for(var t=e.GetRows(e.Foot),i=0;i<t.length;i++)"1"===LoadCache("gantt_resource_use_state")?e.ShowRow(t[i]):e.HideRow(t[i])}),void 0!==Grids.OnRowMove&&$.isFunction(Grids.OnRowMove)||(Grids.OnRowMove=function(e,t,i,a){"production_project_gantt"==e.id?"function"==typeof ganttGridRowMove&&ganttGridRowMove(e,t,i):recalculatePositions(e,t,!0)}),void 0===Grids.OnDeleteAll||!$.isFunction(Grids.OnDeleteAll)){var t={};Grids.OnDeleteAll=function(e,i){void 0===t[e.id]&&(t[e.id]=0),t[e.id]++;var a=e.Rows;for(var n in a){var o=e.GetRowById(n);"Data"==o.Kind&&"Foot"!=o.Fixed&&(t[e.id]%2==0?(e.SetValue(o,"Deleted",!1,1),e.SetValue(o,"Changed",0,1)):(e.SetValue(o,"Deleted",!0,1),e.SetValue(o,"Changed",1,1)))}}}function i(e,t,a){if(t&&(void 0===t.CanSelect||0!=t.CanSelect))for(;t&&"Data"==t.Kind;)t.firstChild&&i(e,t.firstChild,a),e.SetValue(t,"selected",!a,1),t=t.nextSibling}function a(e,t,i){"Data"==t.Kind&&(t.parentNode&&a(e,t.parentNode,i),e.SetValue(t,"selected",!i,1),e.SetValue(t,"Changed",0,1))}function n(e,t){if("Data"==t.Kind){for(var i=t.firstChild,a=!1;i&&"Data"==i.Kind;){if(1==i.selected){a=!0;break}i=i.nextSibling}a||(e.SetValue(t,"selected",0,1),e.SetValue(t,"Changed",0,1),t.parentNode&&n(e,t.parentNode))}}void 0!==Grids.OnChange&&$.isFunction(Grids.OnChange)||(Grids.OnChange=function(e,t,i,a){"production_project_part_grid"==e.id||"production_project_part_grid_popup"==e.id?setTimeout((function(){position_recalculated&&(position_recalculated=!1,e.Save())}),100):"task_work_grid"!=e.id&&"task_material_grid"!=e.id||("contractor_fact_qty"!=i&&"contractor_fact_suma"!=i||setTimeout((function(){"contractor_fact_suma"==i?1==t.contractor_fact_sumaChanged?(e.SetValue(t,"contractor_fact_suma_changed",1,1),e.SetValue(t,"final_fact_suma",t.contractor_fact_suma,1)):(e.SetValue(t,"contractor_fact_suma_changed",0,1),e.SetValue(t,"final_fact_suma",t.final_fact_sumaOrig,1)):"contractor_fact_qty"==i&&(1==t.contractor_fact_qtyChanged?(e.SetValue(t,"contractor_fact_qty_changed",1,1),e.SetValue(t,"contractor_fact_qty",roundNumber(t.contractor_fact_qty,3),1),e.SetValue(t,"final_fact_qty",roundNumber(t.contractor_fact_qty,3),1),e.SetValue(t,"final_fact_suma",roundNumber(t.contractor_fact_qty,3)*t.unit_price,1)):(e.SetValue(t,"contractor_fact_qty_changed",0,1),e.SetValue(t,"final_fact_qty",t.final_fact_qtyOrig,1),e.SetValue(t,"final_fact_suma",t.final_fact_sumaOrig,1))),"function"==typeof checkCanTransferForFactApproval&&checkCanTransferForFactApproval()}),100),"function"==typeof checkCanTariffSubmitToApprove&&checkCanTariffSubmitToApprove(e,t,i))}),void 0!==Grids.OnSelect&&$.isFunction(Grids.OnSelect)||(Grids.OnSelect=function(e,t,o){if(GridsSelectAll[e.id]=!1,o?removeGridCacheSelectedRow(e,t):addGridCacheSelectedRow(e,t),"production_project_part_grid_popup"==e.id){var r=e.Rows;for(var s in r){"Data"===(l=e.GetRowById(s)).Kind&&(e.SetAttribute(l,null,"Selected",0,1),1===o?e.SetAttribute(l,null,"CanSelect",1,1):t.id!=l.id&&e.SetAttribute(l,null,"CanSelect",0,1))}}else if("file_type_grid"==e.id)$("#categories-dialog").dialog("close"),$("#file_type_static").val(t.id),$("#file_type_name").text(t.name),e.DeselectAll();else if("resource_tgrid"==e.id){r=e.Rows;if(3===t.type)for(var s in r){if(!isNaN(s))"Data"===(l=e.GetRowById(s)).Kind&&(1===o?($.taskObject.task_data.resources_company_id=null,e.ShowRow(l),e.task.task_data.is_resource_outsider=!1,e.task.task_data.recalculate_time=!0,e.task.clearContactPersons()):(e.task.task_data.is_resource_outsider=!0,"company/company"===t.object_code&&($.taskObject.task_data.resources_company_id=t.object_id),e.task.task_data.recalculate_time=!1,l.id!==t.id&&e.HideRow(l)))}else{e.task.clearContactPersons(),e.task.task_data.is_resource_outsider=!1,e.task.task_data.recalculate_time=!0;var d=e.GetSelRows();for(var s in r){var l;if(!isNaN(s))"Data"===(l=e.GetRowById(s)).Kind&&(1===o?d.length<=1&&e.ShowRow(l):($.taskObject.task_data.resources_company_id=null,3===parseInt(l.type,10)&&e.HideRow(l)))}}}else-1==$.inArray(e.id,excludedGrids)&&(e.SetValue(t,"selected",!o,1),o?n(e,t.parentNode):a(e,t.parentNode,o),i(e,t.firstChild,o),selectedSequance(e,t,o));if("work_estimate_grid"==e.id){checkAllColumns(e,t,o,{colException:["is_main"],defName:["Task","TaskNoSides"]})}}),void 0!==Grids.OnSelectAll&&$.isFunction(Grids.OnSelectAll)||(Grids.OnSelectAll=function(e,t){return void 0===GridsSelectAll[e.id]&&(GridsSelectAll[e.id]=!0),i(e,e.GetFirst(),!GridsSelectAll[e.id]),GridsSelectAll[e.id]=!GridsSelectAll[e.id],!0}),void 0!==Grids.OnExpand&&$.isFunction(Grids.OnExpand)||(Grids.OnExpand=function(e,t){expanded=!1,expandTimeout&&(clearTimeout(expandTimeout),expandTimeout=null),expandTimeout=setTimeout((function(){Grids.OnExpandAllFinish(e,t)}),1e3)}),void 0!==Grids.OnExpandAllFinish&&$.isFunction(Grids.OnExpandAllFinish)||(Grids.OnExpandAllFinish=function(e,t){expanded=!0}),void 0!==Grids.OnClickPanelSelect&&$.isFunction(Grids.OnClickPanelSelect)||(Grids.OnClickPanelSelect=function(e){"materialmaterial_order"!=e.id&&"sale_estimate_grid"!=e.id||checkSelected(e)}),void 0!==Grids.OnClickHeaderSelect&&$.isFunction(Grids.OnClickHeaderSelect)||(Grids.OnClickHeaderSelect=function(e){"materialmaterial_order"!=e.id&&"sale_estimate_grid"!=e.id||checkSelected(e)})}function addGridCacheSelectedRow(e,t){void 0===grid_selected_rows_cache[e.id]&&clearGridCacheSelectedRows(e),grid_selected_rows_cache[e.id][t.id]=t}function removeGridCacheSelectedRow(e,t){delete grid_selected_rows_cache[e.id][t.id]}function getGridCacheSelectedRows(e){if(e&&e.hasOwnProperty("id"))return $.map(grid_selected_rows_cache[e.id],(function(e,t){return[e]}))}function clearGridCacheSelectedRows(e){grid_selected_rows_cache[e.id]={}}function prepareDatePicker(e,t){var i={singleDatePicker:!0,drops:t&&"down"==t?"down":"up",autoUpdateInput:!1,locale:{format:"YYYY-MM-DD",firstDay:1,daysOfWeek:["Sk","Pr","An","Tr","Kt","Pn","Št"],monthNames:["Sausis","Vasaris","Kovas","Balandis","Gegužė","Birželis","Liepa","Rugpjūtis","Rugsėjis","Spalis","Lapkritis","Gruodis"]}};e=e?"."+e:".date",$(e).not(".has-datepicker").daterangepicker(i),$(e+".no-value").not(".has-datepicker").val(""),$(e).not(".has-datepicker").addClass("has-datepicker"),$(e).on("apply.daterangepicker",(function(e,t){t.startDate.format("YYYY-MM-DD")!=$(this).val()&&$(this).parents("form").first().change(),$(this).val(t.startDate.format("YYYY-MM-DD")),$(this).attr("value",t.startDate.format("YYYY-MM-DD"))}))}function roundNumber(e,t){var i="e".concat(t+1),a="e-".concat(t+1),n="e".concat(t),o="e-".concat(t);return e=Number(Math.round(e+i)+a),e=Number(Math.round(e+n)+o)}function closeTgridMenus(){for(var e in GetGrids()){var t=Grids[e];console.log(t),null!=t&&!1!==t&&(t.CloseDialog(),t.EndEdit(0))}}function deleteGridsOnClose(e){for(var t in Grids){Grids[t];parseInt(t)>=0&&delete Grids[t]}}function closeTgridPopups(){$("div#tabs ul li a").bind("click",(function(){for(var e in GetGrids()){var t=Grids[e];null!=t&&!1!==t&&(t.CloseDialog(),t.EndEdit(0))}})),$("div.sub-tab").bind("click",(function(){for(var e in GetGrids()){var t=Grids[e];null!=t&&!1!==t&&(t.CloseDialog(),t.EndEdit(0))}}))}function isPositiveInteger(e){return parseFloat(e)===parseInt(e)&&!isNaN(e)&&e>=0}function isInteger(e){return parseFloat(e)===parseInt(e)&&!isNaN(e)}function disableAllGrids(){for(var e in GetGrids()){var t=Grids[e];null!=t&&!1!==t&&t.Disable()}}function enableAllGrids(){for(var e in GetGrids()){var t=Grids[e];null!=t&&!1!==t&&t.Enable()}}function destroyDialog(e,t,i,a,n,o){(o||e.html(""),e.is(":data(uiDialog)")&&e.dialog("destroy"),null!=t&&""!==t)?(t.Enable(),void 0!==i&&1===i?(showLoader(),t.Reload(),void 0!==a&&0===a||updateProjectTaskListGridAndGantt(t)):hideLoader()):(hideLoader(),null!=(t=Grids.Active)&&t.Enable());e.parent().removeClass("ui-widget-content"),n||e.remove(),$(document).trigger("dialog_destroyed")}function validateStringLagTime(e){var t=$.trim($(e).val()),i=0===$.trim(t.replace(/(\+|-)?(([0-9]+(h|(min))$)+)|(([0-9]+(h))+(\s)*([0-9]+(min)$)+)|([0-9]+(h|(min))$)+/g,"")).length||"0h"===$.trim(t.toUpperCase())||"0min"===$.trim(t.toUpperCase())||"0h 0min"===$.trim(t.toUpperCase())||0===t;return i?$(e).removeClass("fill-in"):$(e).addClass("fill-in"),i}function validateStringTime(e){var t=$.trim($(e).val().toUpperCase()),i=0===$.trim(t.replace(/(([0-9]+(h|(min))$)+)|(([0-9]+(h))+(\s)*([0-9]+(min)$)+)|([0-9]+(h|(min))$)+/i,"")).length||"0H"===$.trim(t.toUpperCase())||"0MIN"===$.trim(t.toUpperCase())||"0H 0MIN"===$.trim(t.toUpperCase())||0===t;return i?$(e).removeClass("fill-in"):$(e).addClass("fill-in"),i}function initToggler(){$(".toggler").unbind().on("click",(function(){return $(this).parent().find("ul:first").toggle(),$(this).hasClass("expanded")?$(this).removeClass("expanded").addClass("expand"):$(this).removeClass("expand").addClass("expanded"),!1}))}function clog(){console&&(arguments.length>1?console.log(arguments):1===arguments.length?console.log(arguments[0]):console.log(new Date))}function login_box_showhide(){return showHideBox($("#login_box")),!1}function login_box_expand(){return $("#login_box").slideDown(),$("#login_box_trigger").unbind("click",login_box_expand).bind("click",login_box_collapse),!1}function login_box_collapse(){return $("#login_box").slideUp(),$("#login_box_trigger").unbind("click",login_box_collapse).bind("click",login_box_expand),!1}function logout_showhide(){showHideBox($("#user_logout"))}function quickFindOrder(){showHideBox($("#quick_find_order"))}function showHideBox(e){e.hasClass("hidden")?e.slideDown("slow",(function(){e.removeClass("hidden")})):e.slideUp("slow",(function(){e.addClass("hidden")}))}function nextStep(e){return $("#step"+e).length>0?$("#step"+e).fadeOut(200,(function(){$("#step"+(e+1)).fadeIn(200)})):$("#step1").fadeOut(200,(function(){$("#step"+(e+1)).fadeIn(200)})),!1}function resetStep(e){return $("#step"+e).fadeOut(200,(function(){$("#step1").fadeIn(200)})),!1}function order_shipping(){$(".block-sales-order-new .step").fadeOut(200,(function(){$(".block-sales-order-new #shipping_trigger").hide(),$(".block-sales-order-new #money, .block-sales-order-new #shipping, .block-sales-order-new #customer").fadeIn(200)})),recalcTotals()}function order_wizard(){$(".block-sales-order-new #money, .block-sales-order-new #shipping, .block-sales-order-new #customer").fadeOut(200,(function(){$(".block-sales-order-new #shipping_trigger").show(),$(".block-sales-order-new div.step").fadeIn(200),$(".block-sales-order-new .step1, .block-sales-order-new h2.step, .block-sales-order-new #custom").fadeIn(200)}))}function business_customer(e){e.checked?$("tr.business").fadeIn():$("tr.business").fadeOut()}function invoice_add_line(){var e=$("#invoiceForm #InvoiceContent tr.datarow:last").clone(),t=parseInt(e.attr("id").substr(4))+1;e.attr("id","row-"+t),e.find("input, textarea").each((function(){$(this).attr("name").indexOf("[type]")<0?$(this).attr("name",$(this).attr("name").split("["+(t-1)+"]").join("["+t+"]")).val(""):$(this).attr("name",$(this).attr("name").split("["+(t-1)+"]").join("["+t+"]")),$(this).attr("name").indexOf("[qty]")>0&&$(this).val("1"),$(this).attr("name").indexOf("[unit]")>0&&$(this).val("vnt.")})),e.find(".row-sum span").text("0.00"),e.insertAfter($("#invoiceForm #InvoiceContent tr.datarow:last"))}function update_invoice_row(e){var t=$(e).closest("tr");t.find("input").removeClass("error");var i=t.find("input.row-qty").val()*t.find("input.row-prc").val();isNaN(i)?(isNaN(t.find("input.row-qty").val())&&t.find("input.row-qty").addClass("error"),isNaN(t.find("input.row-prc").val())&&t.find("input.row-prc").addClass("error"),t.find(".row-sum span").text("0.00")):t.find(".row-sum span").text(Number(i).toFixed(2)),update_invoice_totals()}function update_invoice_totals(){var e=0;$("#InvoiceContent td.row-sum span").each((function(){e+=Number($(this).text())})),$("#totalExclVat span").text(e.toFixed(2)),$("#totalVat span").text(Number(e*Number(VAT_RATE)/100).toFixed(2)),$("#totalInclVat span").text(Number(e*(1+Number(VAT_RATE)/100)).toFixed(2))}function add_more_attachments(){var e=$("#tpl").clone().attr("id","").insertAfter($("<br />").insertAfter($(".tpl:last")));(e=e.find("input:button")).attr("id","file_"+($("input.file").length-1)),uploaders[uploaders.length]=new AjaxUpload("#"+e.attr("id"),{autoSubmit:!1,name:"file",data:{index:$("input.file").length-1},action:BASE_URL+"order/ajax/upload",onComplete:uploadComplete,onChange:uploaderChange}),e.prev().val("")}function producer_show_line(e){$(e).hide().parent().parent().find("td:first").next().find("table").show()}function plates_next_char(e){var t=$("#item_text_"+e);if(t.val().length>1){var i=t.val().charAt(1);t.val(t.val().charAt(0)),t.next().val(i).next().focus()}else{if(0===t.val().length)return!1;t.next().focus()}}function showLoader(){$("#ajaxLoader").show(),$("#ajaxLoaderAnimation").show()}function hideLoader(){$("#ajaxLoader").hide(),$("#ajaxLoaderAnimation").hide()}function selectorNextStep(e,t){showLoader(),$("#selectorStep").load(BASE_URL+"order/ajax/selectorNextStep",{node_type:e,node_id:t},hideLoader)}function selectorPartnerNextStep(e,t){showLoader(),$("#selectorStep").load(BASE_URL+"partner/ajax/selectorNextStep",{node_type:e,node_id:t},hideLoader)}$(document).ready((function(){closeTgridPopups(),addGridEvents(),history.state&&history.state.tab_id&&$("#"+history.state.tab_id).trigger("click")})),$(document).ready((function(){if("undefined"==typeof _TRANSLATIONS)return alert("Nerastas vertimų failas!!!"),!1;$("#login_box_trigger").click(login_box_expand),$("#login_box_trigger").click(login_box_showhide),$("#login-box .services[id!=active_user]").hide(),$("#login-box").bind("mouseover",(function(){$("table.login").show(),$(this).find(".services").show()})).bind("mouseout",(function(){$(".services[id!=active_user]").hide(),$("table.login").hide()})),$(".block-sales-order-new .choice").hover((function(){$(this).addClass("hover")}),(function(){$(this).removeClass("hover")})),$(".block-sales-order-new #step12 input[type=text]").keyup((function(){plates_next_char($(this).attr("id").substr(10))})),$((function(){})),$("ul.tree li:last-child").addClass("last"),initToggler()}));var uploadedFiles=new Array,addingToBasketId=0,addingToPartnerBasketId=0;function addToBasket(e,t){void 0===t&&(t=!1);var i=$("textarea[name='description']").val(),a=$("input[name='qty']").val();if(!t&&swfu.getStats().files_queued)return addingToBasketId=e,swfu.startUpload(),!1;addingToBasketId=0;var n=uploadedFiles.join(":");uploadedFiles=new Array,showLoader(),$("#order_sales_basket").load(BASE_URL+"order/ajax/addToBasket",{id:e,qty:a,description:i,files:n},(function(){selectorNextStep("","")}))}function addToPartnerBasket(e,t){void 0===t&&(t=!1);var i=$("textarea[name='description']").val(),a=$("input[name='qty']").val();if(!t&&swfu.getStats().files_queued)return addingToPartnerBasketId=e,swfu.startUpload(),!1;addingToPartnerBasketId=0;var n=uploadedFiles.join(":");uploadedFiles=new Array,showLoader(),$("#order_sales_basket").load(BASE_URL+"partner/ajax/addToBasket",{id:e,qty:a,description:i,files:n},(function(){selectorPartnerNextStep("","")}))}function addToOrder(e,t){void 0===t&&(t=!1);$("textarea[name='description']").val(),$("input[name='qty']").val(),$("select[name='discount']").val();if(!t)return addingToBasketId=e,uploadNext(),!1;addingToBasketId=0;var i=uploadedFiles.join(":");uploadedFiles=new Array,showLoader(),$("#uploaded_files").val(i),$("#new_product_fieldset").load(BASE_URL+"order/ajax/addtoorder",$("#new_product_form").serialize(),(function(){selectorNextStep("",""),window.location.reload()}))}function updateDiscount(e,t,i){isNaN(t)||("undefined"==typeof updateDiscountTimeout&&(updateDiscountTimeout=new Array),void 0!==updateDiscountTimeout[e]&&clearTimeout(updateDiscountTimeout[e]),updateDiscountTimeout[e]=i?setTimeout("$.post('"+BASE_URL+"order/ajax/updateItemDiscount', 'index="+e+"&discount_percentage="+t+"', function(sum){ $('tr#row_"+e+" td.center:last').text(sum); recalcTotals(); })",250):setTimeout("$.post('"+BASE_URL+"order/ajax/updateItemDiscount', 'index="+e+"&discount_id="+t+"', function(sum){ $('tr#row_"+e+" td.center:last').text(sum); recalcTotals(); })",250))}function removeFromBasket(e){showLoader(),$("#order_sales_basket").load(BASE_URL+"order/ajax/removeFromBasket",{index:e},hideLoader)}function removeFromPartnerBasket(e){showLoader(),$("#order_sales_basket").load(BASE_URL+"partner/ajax/removeFromBasket",{index:e},hideLoader)}function findCustomer(){$.getJSON(BASE_URL+"order/ajax/findcustomer/code/"+$("#order_customer_code").val(),"",loadCustomer)}function loadCustomer(e){if(void 0!==e.customer){var t=e.customer;$("#order_customer_firstname").val(t.first_name),$("#order_customer_lastname").val(t.last_name),$("#order_customer_phone").val(t.phone),$("#order_customer_email").val(t.email),$("#order_customer_business").attr("checked",t.company_id>0).change()}loadCompany(e)}function findCompany(){$.getJSON(BASE_URL+"order/ajax/findcompany/code/"+$("#order_customer_company_code").val(),"",loadCompany)}function loadCompany(e){if(void 0!==e.company){var t=e.company;$("#order_customer_company_code").val(t.code),$("#order_customer_company_vatcode").val(t.vat_code),$("#order_customer_company_name").val(t.name),$("#order_customer_company_address_street").val(t.street),$("#order_customer_company_address_postcode").val(t.postcode),$("#order_customer_company_address_city").val(t.city_id)}}function updateProductFields(e){"standard"===$(e).val()?$("tr.standard").show():$("tr.standard").hide(),"plates"===$(e).val()?$("tr.plates").show():$("tr.plates").hide(),"canvas"===$(e).val()?$("tr.canvas").show():$("tr.canvas").hide()}function changePlatesBackgroundColor(e){var t="";switch(e){case"golden":t="goldenRod";break;case"yellow":t="yellow";break;case"blue":t="blue";break;case"orange":t="orange";break;case"purple":t="purple";break;case"white":default:t="white"}$("#plates_text input.char").css("background-color",t)}function changePlatesTextColor(e){$("#plates_text").removeClass().addClass(e)}function changePlatesIcon(e){if(""===e)$("#plates_text #item_text_0").removeClass().addClass("char").attr("readonly",!1);else{switch(e){case"LT":className="icon-lt";break;case"P":className="icon-p";break;case"ZAL":className="icon-zal";break;case"LRY":className="icon-lry"}$("#plates_text #item_text_0").val("").attr("readonly",!0).removeClass().addClass("char").addClass(className)}}var DragIcon=null;function initDraggableIcons(){$(".imgNoBorder a img").each((function(){$(this).mousedown((function(e){return dragIcon=this,dragCopy=$(this).clone().css("position","absolute").attr("id","dragcopy").css({left:e.pageX-18+"px",top:e.pageY-18+"px"}),$(document.body).append(dragCopy),$(document).mousemove((function(e){dragCopy.css({left:e.pageX-18+"px",top:e.pageY-18+"px"})})),enableDropping(),!1})),$(this).click((function(){dragCopy&&$("#dragcopy").mouseup()}))})),$("#plates_text input.char").click((function(){$this=$(this),($this.hasClass("clover")||$this.hasClass("playboy")||$this.hasClass("horseshoe")||$this.hasClass("truck")||$this.hasClass("heart"))&&$this.removeClass().addClass("char").attr("readonly",!1)}))}function enableDropping(){$("#plates_text input.char").mouseup((function(){""!==trim($("select#item_icon").val())&&"item_text_0"===$(this).attr("id")||$(this).removeClass().addClass("char").addClass($(dragIcon).attr("rel")).val("").attr("readonly",!0),disableDropping(),dragIcon=null,dragCopy.remove(),dragCopy=null})),$("#dragcopy").mouseup((function(e){$("#plates_text input.char").each((function(){$(this).offset().left<=e.pageX&&$(this).offset().left+$(this).width()>=e.pageX&&$(this).offset().top<=e.pageY&&$(this).offset().top+$(this).height()>=e.pageY&&$(this).mouseup()})),dragCopy&&(dragCopy.remove(),dragCopy=null,disableDropping())})),$(document.body).mouseup((function(){disableDropping(),dragIcon=null}))}function disableDropping(){$("#plates_text input.char").unbind("mouseup"),$(document.body).unbind("mouseup"),$(document).unbind("mousemove")}function initializeCharValidation(){$("#plates_text .char").keyup((function(e){if(0===e.keyCode&&(e.keyCode=$(this).val().charCodeAt(0)),37===e.keyCode&&$(this).prev().focus(),39===e.keyCode&&$(this).next().focus(),e.keyCode=$(this).val().charCodeAt(0),(e.keyCode<"a".charCodeAt(0)||e.keyCode>"z".charCodeAt(0))&&(e.keyCode<"A".charCodeAt(0)||e.keyCode>"Z".charCodeAt(0))&&(e.keyCode<"0".charCodeAt(0)||e.keyCode>"9".charCodeAt(0))&&"ĄČĘĖĮŠŲŪŽąčęėįšųūž".indexOf(String.fromCharCode(e.keyCode))<0)return $(this).val(""),!1;$(this).val().length>1&&$(this).val($(this).val().substr(0,1)),1===$(this).val().length&&$(this).next().focus()}))}function serializePlates(){var e=new Array;$("#plates_text input.char").each((function(){var t=$(this);t.removeClass("char");var i=trim(t.attr("class"));t.addClass("char"),e[e.length]=""!==i?"["+i+"]":t.val()}));var t=$("input[name=item[holder]]").attr("checked")?"&holder=1":"";return"background="+$("#item_color_bg").val()+"&color="+$("#item_color_text").val()+"&text="+e.join("|")+t}function addPlatesToBasket(e){$("#order_sales_basket").load(BASE_URL+"order/ajax/addPlatesToBasket",{id:e,data:serializePlates()},(function(){selectorNextStep("","")}))}function addPlatesToPartnerBasket(e){$("#order_sales_basket").load(BASE_URL+"partner/ajax/addPlatesToBasket",{id:e,data:serializePlates()},(function(){selectorPartnerNextStep("","")}))}var canvasId=null;function addCanvasToBasket(e,t){if(null===canvasId)return canvasId=e,void swfu.startUpload();$("#order_sales_basket").load(BASE_URL+"order/ajax/addCanvasToBasket",{id:e,file:t,description:$("textarea[name='description']").val()},(function(){canvasId=null,selectorNextStep("","")}))}function addCanvasToPartnerBasket(e,t){if(null===canvasId)return canvasId=e,void swfu.startUpload();$("#order_sales_basket").load(BASE_URL+"partner/ajax/addCanvasToBasket",{id:e,file:t,description:$("textarea[name='description']").val()},(function(){canvasId=null,selectorPartnerNextStep("","")}))}function updateInitPrice(e,t){isNaN(t)?clog(t):$.post(BASE_URL+"order/ajax/updateItemInitPrice",{index:e,price:t},(function(i){$("tr#row_"+e+" td.center:last").text(i),$("#old_init_price_"+e).text(Number(t).toFixed(2)),recalcTotals()}))}function recalcTotals(){if(("undefined"==typeof TAX_RATE||isNaN(TAX_RATE))&&(TAX_RATE=0),$("#endprice_without_vat").length>0){var e=0;$("#order_sales_basket tr:not(.first)").each((function(){e+=Number($(this).find("td:nth(4)").text().split(" ")[0])})),$("#endprice_without_vat").text(Number(e).toFixed(2)),$("#endprice_with_vat").text(Number(e*(1+TAX_RATE/100)).toFixed(2))}}function trim(e){if("function"==typeof $.trim(e))return $.trim(e);for(;" "===e[0];)e=e.substr(1);for(;" "===e[e.length-1];)e=e.substr(0,e.length-1);return e}function preparePing(){setTimeout((function(){$.get(PING_URL,"",preparePing)}),1e4*PING_REFRESH)}function checkAllInvoices(){var e=$("input[name=export_all]").attr("checked");$("input.export").attr("checked",e)}function initSWFU(){swfu=new SWFUpload({upload_url:BASE_URL+"order/ajax/upload",flash_url:MEDIA_URL+"swfupload.swf",file_size_limit:"20 MB",file_post_name:"Filedata",button_placeholder_id:"file_0",button_image_url:SKIN_URL+"images/swfu_button.png",button_text:'<span class="btnText">Surasti</span>',button_text_style:".btnText { font-size: 11px; font-family: Arial, Tahoma, Veradana; width: 120px; text-align: center; }",button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,button_width:120,button_height:19,debug:!1,file_queued_handler:function(e){$("#files").val("text"===$("#files").attr("type")?e.name:$("#files").val()+e.name+"\n")},file_queue_error_handler:function(e,t,i){t===SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT?alert('Failas "'+e.name+'" nebuvo pridėtas nes viršija leistiną failo dydį'):t===SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE?alert('Failas "'+e.name+'" nebuvo pridėtas nes jis yra tuščias'):alert("Klaida "+t+": "+i)},upload_error_handler:function(e,t,i){alert('Įkeliant failą "'+e.name+'" įvyko klaida '+t+": "+i)},upload_success_handler:function(e,t,i){"ERROR"!==t.substring(0,5)?uploadedFiles[uploadedFiles.length]=t:alert(e.name+": "+t.substring(7))},upload_complete_handler:function(e){for(var t=0;null!==swfu.getFile(t);){if(-1===swfu.getFile(t).filestatus)return void swfu.startUpload();t++}addingToBasketId>0&&addToBasket(addingToBasketId,!0),addingToPartnerBasketId>0&&addToPartnerBasket(addingToPartnerBasketId,!0)}})}function json_encode(e){var t,i=this.window.JSON;try{if("object"==typeof i&&"function"==typeof i.stringify){if(void 0===(t=i.stringify(e)))throw new SyntaxError("json_encode");return t}var a=function(e){var t=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?'"'+e.replace(t,(function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'},n=function(e,t){var i="",o=0,r="",s="",d=0,l=i,c=[],u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),typeof u){case"string":return a(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(this.PHPJS_Resource&&u instanceof this.PHPJS_Resource||window.PHPJS_Resource&&u instanceof window.PHPJS_Resource)throw new SyntaxError("json_encode");if(i+="    ",c=[],"[object Array]"===Object.prototype.toString.apply(u)){for(d=u.length,o=0;o<d;o+=1)c[o]=n(o,u)||"null";return s=0===c.length?"[]":i?"[\n"+i+c.join(",\n"+i)+"\n"+l+"]":"["+c.join(",")+"]",i=l,s}for(r in u)Object.hasOwnProperty.call(u,r)&&(s=n(r,u))&&c.push(a(r)+(i?": ":":")+s);return s=0===c.length?"{}":i?"{\n"+i+c.join(",\n"+i)+"\n"+l+"}":"{"+c.join(",")+"}",i=l,s}};return n("",{"":e})}catch(e){if(!(e instanceof SyntaxError))throw new Error("Unexpected error type in json_encode()");return this.php_js=this.php_js||{},this.php_js.last_error_json=4,null}}function validateForm(e,t,i){var a=!0;return void 0===t&&(t=!0),$("#"+e).find(".fill-in").each((function(){$(this).removeClass("fill-in")})),$("#"+e).find(".required").each((function(){"radio"!==$(this).attr("type")||t&&!$(this).is(":visible")?""!==$.trim($(this).val())&&"-1"!==$.trim($(this).val())&&null!==$(this).val()||t&&!$(this).is(":visible")||"SELECT"!==this.nodeName?""!==$.trim($(this).val())&&null!==$(this).val()||t&&!$(this).is(":visible")||($(this).addClass("fill-in"),$("#"+e+" #token-input"+$(this).attr("id"))&&$("#"+e+" #token-input-"+$(this).attr("id")).parents("ul").addClass("fill-in"),a=!1):($(this).addClass("fill-in"),$("#"+e+" #"+$(this).attr("id")+"_chzn a").addClass("fill-in"),a=!1):$("input[name="+$(this).attr("name")+"]").is(":checked")||($(this).parent().addClass("fill-in"),a=!1)})),$("#"+e+" .validate").each((function(){""===$(this).attr("pattern")||t&&!$(this).is(":visible")||(new RegExp($(this).attr("pattern")).test($(this).val())||(a=!1,$(this).addClass("fill-in")));$(this).hasClass("validate-number")&&(a=a&&validateNumber($(this)))})),!0===a&&"function"==typeof i&&i($("#"+e)),a}function validateNumber(e,t){if(""===e.val())return!0;e.removeClass("fill-in");var i=e.val();e.val(i.replace(",","."));var a=RegExp(/^(0[0-9]+)$/);if(a.test(e.val())?(i=e.val(),e.val("0."+i.substring(1))):(a=RegExp(/^(-0[0-9]+)$/)).test(e.val())&&(i=e.val(),e.val("-0."+i.substring(2))),isNaN(e.val()))return e.addClass("fill-in"),!1;if(!RegExp(/^(([0]{1}|((-?[0]{1}[.,]{1})|(-?[1-9]{1}[0-9]*[.,]{0,1}))[0-9]*))$/).test(e.val()))return e.addClass("fill-in"),!1;if(e.attr("precision")){var n=e.attr("precision"),o=10,r=e.val(),s=r.split(".");if(void 0!==s[1]&&s[1].length>n){for(var d=n;d>1;d--)o*=10;e.val(Math.floor(r*o)/o)}}return e.hasClass("not-negative")&&e.val()<0?(e.addClass("fill-in"),!1):!(e.hasClass("validate-price")&&e.val()>0)||(e.val(i.replace(".",",")),!0)}function secondsToStringTime(e,t){null===t&&(t=!0);var i=0;t&&(e-=28800*(i=Math.floor(e/28800)));var a=Math.floor(e/3600);e-=3600*a;var n=Math.floor(e/60);return i>0?i+="d ":i="",a>0?a+="h ":a="",n>0?n+="min ":n="",time=i+a+n,$.trim(time)}function stringTimeToSeconds(e){var t,i=$.trim(e).length,a=0,n=0,o=0;if(2===(t=String(e+"-").split("d")).length){a=t[0];if("-"!==$.trim(t[1]))e=t[1];else e=""}if(2===(t=String(e+"-").split("h")).length){n=t[0];if("-"!==$.trim(t[1]))e=t[1];else e=""}if(2===(t=String(e+"-").split("min")).length){o=t[0];if("-"!==$.trim(t[1]))e=t[1];else e=""}var r=60*a*60*8+60*n*60+60*o;return 0>r&&0<i?"error":r}function stringTimeToSeconds2(e){var t=144e3,i=0,a=String(e).match(/(\d+\w+)/g);if(a)for(var n=0;n<a.length;n++){var o=a[n],r=o.match(/[a-zA-Z]+/);if(r)switch(r[0].toLowerCase()){case"m":i+=576e3*parseFloat(o);break;case"w":i+=parseFloat(o)*t;break;case"d":i+=28800*parseFloat(o);break;case"h":i+=3600*parseFloat(o);break;case"min":i+=60*parseFloat(o)}}return i}function secondsToHours(e){return e/3600}function highLightTR(e,t,i,a,n,o){var r=t.parentNode;e=e||(window.event?window.event:null);for(var s=0;s<r.childNodes.length;s++){var d=r.childNodes[s];void 0!==d&&"TR"===d.tagName&&(d.id!==t.id?"true"!==d.getAttribute("selected")||e.ctrlKey||e.metaKey||deselect(d,i,a):"true"===d.getAttribute("selected")&&(e.ctrlKey||e.metaKey)?deselect(d,i,a):select(d,n,o))}}function select(e,t,i){e.setAttribute("selected","true"),e.bgColor=t;try{changeTextColor(e,htLightTextColor)}catch(e){}}function deselect(e,t,i){e.setAttribute("selected",""),e.bgColor=t;try{changeTextColor(e,i)}catch(e){}}function _submit(e){var t=document.getElementById("selected_contacts");if(t){var i=t.rows,a=i.length,n="";if(a>=e){for(var o=0;o<a;o++){var r=i[o];void 0!==r&&r.id&&(n+=r.id+",")}n=n.substr(0,n.length-1),alert(n)}else alert("Please choose at least "+e+" contact(s).")}}function changeHighLightTR(e,t){if(e=e||(window.event?window.event:null)){for(var i=t.rows,a=i.length,n=-1,o=0;o<a;o++){var r=i[o];if(void 0!==r&&"true"===r.getAttribute("selected")){r,n=r.rowIndex;break}}switch(e.keyCode){case 38:n>0&&highLightTR(e,i[n-1],"#ffffff","#000000","#316AC5","#ffffff");break;case 40:n>=0&&n<a-1&&highLightTR(e,i[n+1],"#ffffff","#000000","#316AC5","#ffffff")}}}function showHideEditField(e,t,i){i?($("#"+e).show().attr("style","display: inline"),$("#"+e).removeClass("hidden").addClass("form-inline"),$("#"+t).hide()):($("#"+e).hide(),$("#"+t).show().attr("style","display: inline"))}function createCookie(e,t,i){var a="";if(i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3),a="; expires="+n.toGMTString()}top.document.cookie=e+"="+t+a+"; path=/"}function readCookie(e){for(var t=e+"=",i=top.document.cookie.split(";"),a=0;a<i.length;a++){for(var n=i[a];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null}function eraseCookie(e){createCookie(e,null,-1)}$(".validate-number").on("keyup",(function(e){if(void 0!==e.which){var t=validateNumber($(this));return t&&$(this).keyup(),t}}));var cookieRegistry=[];function listenCookieChange(e,t){setInterval((function(){if(cookieRegistry[e]){if(readCookie(e)!==cookieRegistry[e]){var i=cookieRegistry[e],a=readCookie(e);return cookieRegistry[e]=a,t(a,i)}"-1"===readCookie(e)&&$.cookie(e,null)}else cookieRegistry[e]=readCookie(e)}),5e3)}function updateCookieValue(e,t,i){setInterval((function(){return createCookie(e,t),i()}),5e3)}function milisecondsToDate(e,t){var i=t;if(e>0){""===$.trim(t)&&(t="Y-m-d");var a=new Date(e),n=a.getFullYear(),o=a.getMonth()+1;o<10&&(o="0"+o);var r=a.getDate();r<10&&(r="0"+r),i=(i=(i=i.replace("Y",n)).replace("m",o)).replace("d",r)}return i}function milisecondsToHours(e){return e/36e5}function markInputChanged(e){var t=$(e);t.hasClass("changed")||t.addClass("changed")}function markInputUnchanged(e){$(e).removeClass("changed")}function initInplaceEdit(){$(".div_editable").each((function(){$(this).on("click",(function(){var e=$(this).find("span.value_text");if(!e.is(":visible"))return!1;e.hide();var t=$(this).find(".editable-field-container"),i=$(this).find(".editable_field :first");t.show(1,(function(){if(i.hasClass("mce_editor"))try{tinyMCE.execCommand("mceAddControl",!1,i.attr("id"))}catch(e){console.log(e)}i.is("select")?$("#"+i.attr("id")+"_chzn").length>0?$("#"+i.attr("id")+"_chzn").trigger("mousedown"):i.trigger("mousedown"):i.focus()})),addBlurEvent()}))}))}function addBlurEvent(){$(document).mouseup((function(e){var t=$(this).find(".editable-field-container:visible"),i=$(".mce_forecolor:visible"),a=$("#ui-datepicker-div:visible");if(void 0!==t&&0===t.has(e.target).length&&void 0!==i&&0===i.has(e.target).length&&void 0!==a&&0===a.has(e.target).length){var n="";t.find(".editable_field").each((function(){$(this).is("select")?n+=$(this).find("option:selected").text()+" ":n+=$(this).val()+" ";var e=$(this).attr("id");if(tinyMCE.getInstanceById(e)){var t="",i=tinyMCE.get(e);void 0!==i&&(t=i.getContent(),$(this).html(t),$.trim(t).length>0&&$(this).parents(".div_editable").find("span.value_text").html(t),tinyMCE.execCommand("mceFocus",!1,e),tinyMCE.execCommand("mceRemoveControl",!0,e))}})),setTimeout((function(){""===$.trim(n)&&(n=t.find(".editable_field").is("select")?_TRANSLATIONS.SELECT_AN_OPTION:_TRANSLATIONS.NO_INFORMATION),hideEditFields(t,n)}),30)}}))}function hideEditFields(e,t){$(e).parents(".div_editable").find("span.value_text").text(t).show(),$(e).hide(),$(e).trigger("change")}!function(e){e.fn.hoverIntent=function(t,i){var a,n,o,r,s={sensitivity:7,interval:100,timeout:0};s=e.extend(s,i?{over:t,out:i}:t);var d=function(e){a=e.pageX,n=e.pageY},l=function(t,i){if(i.hoverIntent_t=clearTimeout(i.hoverIntent_t),Math.abs(o-a)+Math.abs(r-n)<s.sensitivity)return e(i).unbind("mousemove",d),i.hoverIntent_s=1,s.over.apply(i,[t]);o=a,r=n,i.hoverIntent_t=setTimeout((function(){l(t,i)}),s.interval)},c=function(t){var i=jQuery.extend({},t),a=this;a.hoverIntent_t&&(a.hoverIntent_t=clearTimeout(a.hoverIntent_t)),"mouseenter"===t.type?(o=i.pageX,r=i.pageY,e(a).bind("mousemove",d),1!==a.hoverIntent_s&&(a.hoverIntent_t=setTimeout((function(){l(i,a)}),s.interval))):(e(a).unbind("mousemove",d),1===a.hoverIntent_s&&(a.hoverIntent_t=setTimeout((function(){!function(e,t){t.hoverIntent_t=clearTimeout(t.hoverIntent_t),t.hoverIntent_s=0,s.out.apply(t,[e])}(i,a)}),s.timeout)))};return this.bind("mouseenter",c).bind("mouseleave",c)}}(jQuery),
/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
function(e){e.cookie=function(t,i,a){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(i))||null==i)){if(a=e.extend({},a),null==i&&(a.expires=-1),"number"==typeof a.expires){var n=a.expires,o=a.expires=new Date;o.setDate(o.getDate()+n)}return i=String(i),document.cookie=[encodeURIComponent(t),"=",a.raw?i:encodeURIComponent(i),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}for(var r,s=(a=i||{}).raw?function(e){return e}:decodeURIComponent,d=document.cookie.split("; "),l=0;r===d[l]&&d[l].split("=");l++)if(s(r[0])===t)return s(r[1]||"");return null}}(jQuery),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,(function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""})),e};var inputDelay=function(){var e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}();function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function showHideFieldsetContent(e){$("#"+e).is(":visible")?$("#"+e).hide():$("#"+e).show()}function dialogue(e,t){$("<div />").qtip({content:{text:e,title:t},position:{my:"center",at:"center",target:$(window)},show:{ready:!0,modal:{on:!0,blur:!1}},hide:!1,style:"qtip-light qtip-rounded qtip-dialogue",events:{render:function(e,t){$("button",t.elements.content).click(t.hide)},hide:function(e,t){t.destroy()}}})}function Confirm(e,t,i,a){var n=$("<p />",{text:e}),o=$("<button />",{text:"Ok",click:function(){a(!0)}});$("<button />",{text:"Cancel",click:function(){a(!1)}});n.add(o),dialogue(n.add(o),t)}function showMessage(e,t,i,a){void 0===i&&(i=!1),void 0===a&&(a=2e3);try{var n=_TRANSLATIONS.INFO,o="";switch(t){case"error":case"error-message":n=_TRANSLATIONS.ERROR,o="error";break;case"success":case"success-message":o="success";break;default:n=_TRANSLATIONS.INFO,o="info"}new PNotify({title:n,text:e,type:o,buttons:{sticker:!1},delay:a,styling:"bootstrap3"})}catch(e){console.log(e)}}function hideMessage(e){$("#messageIcon").hide().removeClass(e),"undefined"===e||null===e?$("#ajaxMessage").animate(2e3,(function(){$(this).removeClass($(this).attr("class_name")).hide()})):$("#ajaxMessage").attr("class_name",e).animate(2e3,(function(){$(this).removeClass($(this).attr("class_name")).hide()}))}function initChosen(e,t){var i={placeholder_text:_TRANSLATIONS.SELECT_AN_OPTION,no_results_text:_TRANSLATIONS.NO_RESULT_MATCH,disable_search_threshold:21,allow_single_deselect:!$("#"+e).hasClass("required")};i=$.extend(i,t),$("#"+e).chosen(i)}function stringTimeToMiliseconds(e){var t=e.match(/([+|-]*)([0-9.]*)(ms|m|s|h|d|w)*/i);if(""!==t){var i=t[1],a=t[2],n=t[3];if(n){switch(n.toLowerCase()){case"w":a*=144e6;break;case"d":a*=288e5;break;case"h":a*=36e5;break;case"m":a*=6e4;break;case"s":a*=1e3}return"-"===i&&(a*=-1),a}}return 0}function fullCalendarheaderContent(){return{createButton:function(){$(document).trigger("createNewEvent")}}}function secondsToTime(e){if(isNaN(e))return"--:--";var t="";e<0&&(t="-",e*=-1);var i=Math.floor(e/3600),a=Math.floor((e-3600*i)/60);return i<10&&(i="0"+i),a<10&&(a="0"+a),t+i+":"+a}function timeToSeconds(e){"object"==typeof e&&(e=e.val());var t=e.split(":");return 3600*Number(t[0])+60*Number(t[1])}function validateTime(e){"object"==typeof e&&(e=e.val());var t=e.split(":");return 24>Number(t[0])&&60>Number(t[1])}function confirmDialogClose(e){0>=$("#confirm_close_dialog").length&&$("body").append('<div id="confirm_close_dialog" class="hidden"></div>');var t={};t[_TRANSLATIONS.YES]=function(){e.dialog("option","beforeClose",(function(){})),e.dialog("close"),e.remove(),destroyDialog($(this))},t[_TRANSLATIONS.NO]=function(){return destroyDialog($(this)),!1},$("#confirm_close_dialog").dialog({width:350,modal:!0,buttons:t,close:function(){return destroyDialog($(this)),!1}}).text(_TRANSLATIONS.ALL_CHANGES_WILL_BE_LOST_DO_YOU_WANT_TO_CONTINUE).addClass("center")}function setQuickLinksFieldsDefaultValues(){$("#project-type-id").val($("select#project-type-id option:first").attr("value")),$("#project-datapicker-container").hide(),$("#pa-project-name").empty(),$("#pa-project-datapicker").val(""),$("#pa-project-id").val(""),$("#pa-project-label").val(""),$(".quick-links-select").each((function(){$(this).children("option:first").attr("value"),$(this).val($(this).children("option:first").attr("value")),$(this).trigger("liszt:updated")}))}function toggleQuickLinks(){$("#quick-links-controll-switch").hasClass("open")?$("#quick-links-controll-switch").removeClass("open"):($("#quick-links-controll-switch").addClass("open"),setQuickLinksFieldsDefaultValues()),$("#quick_links_container").toggle()}function loadTaskMaterialData(e,t){var i=$.ajax({url:t,type:"POST",dataType:"html"});i.done((function(t){e.html(t)})),i.fail((function(e,t){alert("Request failed: "+t)}))}function toggleContainer(e,t){e.toggleClass("hidden"),t()}function checkAllColumns(e,t,i,a){if(a.defName&&-1!=$.inArray(t.Def.Name,a.defName))for(var n in e.Cols){var o=e.Cols[n];if("Bool"==o.Type&&0!=t[o.Name+"CanEdit"]){if(a.colException&&-1!=$.inArray(o.Name,a.colException))continue;changeValue(e,t,i?{column:n,value:0}:{column:n,value:1})}}}function changeChildsValue(e,t,i,a){doRecursion(e,t,"changeValue",{column:i,value:parseInt(a)},!0)}function changeAllRowsValue(e,t,a,n,o){n=n?0:1;var r=e.Rows;for(i in r){if("object"==typeof o){if("Data"!=r[i].Kind||o&&!o[r[i].Def.Name])continue}else if("Data"!=r[i].Kind||o&&r[i].Def.Name!=o)continue;0!=r[i][a+"CanEdit"]&&changeValue(e,r[i],{column:a,value:n})}}function setAllRowsValue(e,t,a,n){var o=(e=Grids[e]).Rows;for(i in o){var r=o[i];r.Def.Name!=n&&"Data"==r.Kind&&parseInt(r.id)>0&&0!=r[t+"CanEdit"]&&changeValue(e,r,{column:t,value:a})}}function changeValue(e,t,i){e.SetValue(t,i.column,i.value,1)}function calculateSum(e,t){var i=0;if(e.childNodes.length>0){for(var a=e.firstChild;a.nextSibling;)a[t]&&(i+=a[t]),a=a.nextSibling;e.lastChild[t]&&(i+=e.lastChild[t])}return i}function selectedSequance(e,t,i){if(void 0===e.row_select_sequence&&(e.row_select_sequence=[]),!t.is_project)if(i){var a=$.inArray(t.id,e.row_select_sequence);~a&&e.row_select_sequence.splice(a,1)}else e.row_select_sequence.push(t.id)}function openChooseMaterialDialog(e,t,i){var a=BASE_URL+"material/order/choosematerial",n={};e.categoryId&&(a+="/category/"+e.categoryId),e.materialId&&(a+="/material/"+e.materialId),n[_TRANSLATIONS.CHOOSE]=function(){var a=$("#category").val(),n=$("#category").find("option[value="+a+"]").first().text(),o=$("#material").val(),r=$("#material").find("option[value="+o+"]").first().text();i||(i="material"),t.SetValue(e,"category",n,1),t.SetValue(e,i,r,1),t.SetValue(e,"categoryId",a,1),t.SetValue(e,"materialId",o,1),$(this).dialog("destroy"),$("#choose-material").html("")},n[_TRANSLATIONS.CANCEL]=function(){$(this).dialog("destroy"),$("#choose-material").html("")},$("#choose-material").load(a).dialog({position:{top:7},width:520,height:450,modal:!0,buttons:n,close:function(){$("#choose-material").html(""),$("#choose-material").dialog("destroy")}})}$(document).ready((function(){function e(e){var t=$(this).data("qtip");!0!==t.get("show.persistent")&&(clearTimeout(t.timer),"mouseover"!==e.type&&(t.timer=setTimeout(t.hide,7e3)))}window.createGrowl=function(t,i,a){var n=$(".qtip.jgrowl:visible:last");$(document.body).qtip({content:{text:a,title:{text:i,button:_TRANSLATIONS.CLOSE}},position:{my:"top right",at:(n.length?"bottom":"top")+" right",target:n.length?n:$(window),adjust:{y:5},effect:function(e,t){$(this).animate(t,{duration:200,queue:!1}),e.cache.finalPos=t}},show:{event:!1,ready:!0,effect:function(){$(this).stop(0,1).fadeIn(400)},delay:0,persistent:t},hide:{event:!1,effect:function(e){$(this).stop(0,1).fadeOut(400).queue((function(){e.destroy(),updateGrowls()}))}},style:{classes:"jgrowl qtip-dark qtip-rounded",width:300,tip:!1},events:{render:function(t,i){e.call(i.elements.tooltip,t)}}}).removeData("qtip")},window.updateGrowls=function(){var e,t=$(".qtip.jgrowl"),i=t.outerWidth(),a=t.outerHeight(),n=t.eq(0).qtip("option","position.adjust.y");t.each((function(t){var o=$(this).data("qtip");o.options.position.target=t?[e.left+i,e.top+a*t+Math.abs(n*(t-1))]:$(window),o.set("position.at","top right"),t||(e=o.cache.finalPos)}))},$(document).delegate(".qtip.jgrowl","mouseover mouseout",e)})),$(document).mouseup((function(e){var t=$("#quick_links_container");0!==t.has(e.target).length||"quick_links_container"==e.target.id||"quick-links-controll-switch"==e.target.id||"ABBR"===e.target.tagName&&0!==$(document.elementFromPoint(e.clientX-20,e.clientY)).parents("#quick_links_container").length||($("#quick-links-controll-switch").removeClass("open"),t.hide())}));var position=1;function calcPos(e,t,i){if(i||(position=1),t.nextSibling)for(;t.nextSibling;)e.SetValue(t,"position",position,1),t.firstChild&&calcPos(e,t.firstChild,!0),position++,t=t.nextSibling;return e.SetValue(t,"position",position,1),!t.nextSibling&&t.firstChild&&calcPos(e,t.firstChild,!0),!0}function getFirstRow(e,t){return e?e.Level>0?getFirstRow(e.parentNode):e.parentNode.firstChild:t?t.Body.firstChild.firstChild:null}function doRecursion(e,t,i,a,n){for(var o=0;t.nextSibling;)t.firstChild&&doRecursion(e,t.firstChild,i,a),n&&0==o?t=t.nextSibling:(window[i](e,t,a),t=t.nextSibling,o++);t.nextSibling||(n||window[i](e,t,a),t.firstChild&&doRecursion(e,t.firstChild,i,a))}function preventGridLink(e){(e||window.event).preventDefault()}function recalculatePositions(e,t){setTimeout((function(){var i=getFirstRow(t,e);calcPos(e,i)&&(position_recalculated=!0)}),50)}function addGroupOrItem(e,t,i,a){if(i)if(i.is_group)var n=e.AddRow(i,null,7,null);else if(i.parentNode&&"I"==i.nodeName)n=e.AddRow(i.parentNode,null,7,null);else n=e.AddRow(null,null,7,null);else n=e.AddRow(null,null,!0);n.CanSelect=0,t?(n.is_group=1,e.ChangeDef(n,"Group",1),e.SetValue(n,"name",_TRANSLATIONS.NEW_GROUP,1)):(e.ChangeDef(n,"R",1),e.SetValue(n,"name",_TRANSLATIONS.NEW_TASK,1),e.SetValue(n,"billable",1,1),a?e.SetValue(n,"measurement_id",a,1):e.SetValue(n,"measurement_id",1,1)),e.Focus(n,"name",null,!0),i&&"I"==i.nodeName?recalculatePositions(e,getFirstRow(i)):recalculatePositions(e,getFirstRow(n))}function addGridItem(e,t,i){if(i){var a=e.AddRow(t,null,7);e.SetValue(a,"parent_id",t.id,1)}else{a=e.AddRow(t.parentNode,t.nextSibling,7);e.SetValue(a,"parent_id",t.parentNode.id,1)}recalculatePositions(e,getFirstRow(a))}function filter(e){var t=$(e).parents("form").first(),i=t.attr("data-grid-id"),a=Grids[i];if(a){formInputs=$(t).find(".filter_input");var n=!1,o=!1;$.each(formInputs,(function(){if($(this).attr("name")){n=!0;var t=$(this).val();"checkbox"==$(this).attr("type")&&(t="checked"==$(this).attr("checked")?1:0),e.attr("disabled","disabled"),a.Source.Data.Param[$(this).attr("name")]=t,1==$(this).attr("data-reload_layout")&&$(this).attr("data-value")!=$(this).val()&&(o=!0,a.Source.Layout.Param[$(this).attr("name")]=$(this).val(),$(this).attr("data-value",$(this).val()))}})),n&&(o?a.Reload():a.ReloadBody())}}function updateChangesList(e){$("#"+e+"-changes").length>0&&changes_params[e]&&(changes_params[e].short=1,$("#"+e+"-changes").load(changes_params[e].url,changes_params[e]))}function openShortDetailsDialog(e,t,i,a,n){i.modal=!0,i.position=[$(window).width()/2-i.width/2,40],i.closeText=_TRANSLATIONS.CLOSE,i.close=function(){$("#"+t).remove()},$("body").append('<div id="'+t+'" style="overflow:visible;"></div>');var o=$("#"+t).load(BASE_URL+e,a,(function(e){var i=!0;try{var a=$.parseJSON(e)}catch(e){i=!1}i&&a&&"1"==a.error&&(showMessage(a.error_message,"error-message"),$("#"+t).html(""),$("#"+t).dialog("destroy")),n&&n.tabId&&$("#"+n.tabId+" a").trigger("click")})).dialog(i);o.dialog("option","resizable",!1),o.dialog("option","title","")}function splitItem(e,t,i){0>=$("#split-item-dialog").length&&$("body").append('<div id="split-item-dialog" class="hidden"></div>');var a={};a[_TRANSLATIONS.SAVE]=function(){showLoader();var t=new Number($("#edit-current_total_value").val()),a=$("#edit-maximum_split_total").val();if(valid=t>0&&t<a,!valid)return hideLoader(),void showMessage(_TRANSLATIONS.PRODUCTION_INCORRECT_SPLIT_VALUE,"error-message");var n=$("#edit-item-split-form");$.post(i,n.serialize(),(function(t){hideLoader(),t.success&&(destroyDialog($("#split-item-dialog")),showMessage(t.success_message,"success-message"),e.Enable(),e.ReloadBody())}),"json")},a[_TRANSLATIONS.CANCEL]=function(){$("#split-item-dialog").html(""),e.Enable(),destroyDialog($(this))},$("#split-item-dialog").load(t).dialog({modal:!0,width:400,height:240,buttons:a,close:function(){$("#split-item-dialog").html(""),e.Enable()}}),e.Disable()}function closeModal(e,t){$("#"+e).modal("hide"),t&&Grids[t].ReloadBody()}function importFile(e,t,i){var a=$("#"+e);a.length>0?a.removeClass("hidden"):a=$("<div/>").attr("id",e).css("z-index","99999").appendTo("body");var n={title:t+" importavimas",buttons:{import:{title:"Importuoti",onclick:"importData()",class:"md-button md-raised md-ink-ripple green-button mini-button save import_button",icon:"fa fa-upload"}},onclose:function(e){a.remove()}};i.modal_id=e,a.loadinmodal(BASE_URL+"production/import/openimport/ajax/1/",i,n)}$(document).on({click:function(){$(".simplyfied_tab").addClass("gray").removeClass("active_simplyfied_tabs"),$(this).removeClass("gray").addClass("active_simplyfied_tabs"),$(".simplyfied_tab_container").hide(),$("#"+$(this).attr("id")+"_container").show()}},".simplyfied_tab");var GLOBAL_HISTORY_STATES={},GLOBAL_CURRENT_HISTORY_STATE_NR=0,GLOBAL_CURRENT_HISTORY_STATE_INFO={};function loadHistoryState(e){if(null!=e)if(e.remove_content)$("#"+e.old_content_id).hide();else if(void 0===e.tab_id){e.old_content_id!=e.new_content_id&&$("#"+e.old_content_id).hide(),0==(t=$("#"+e.new_content_id)).length&&(t=$("<div/>").attr("id",e.new_content_id).addClass("loaded-page flex-auto").appendTo("#content-layout")),t.loadContent(e.load_url,e.params,!0)}else{var t;$("#"+e.old_content_id).hide(),0==(t=$("#"+e.new_content_id)).length&&(t=$("<div/>").attr("id",e.new_content_id).addClass("loaded-page flex-auto").appendTo("#content-layout")),t.loadContent(e.load_url,e.params,!0,(function(){e.tab_id&&$("#"+e.tab_id).length>0&&setTimeout((function(){$("#"+e.tab_id).trigger("click",{triggered:!0})}),1e3)}))}}function addHistoryState(e){null==e&&(e={});var t=GLOBAL_CURRENT_HISTORY_STATE_NR+1;e.history_state_nr=t;var i="",a="";if(void 0!==e.page_title&&(i=e.page_title),void 0!==e.page_url&&(a=BASE_URL+e.page_url),void 0!==e.content_data){var n=generateUrl(e.content_data.load_url_data.url,e.content_data.load_url_data.params);e.content_data.inside_url_data.url&&(a=BASE_URL+generateUrl(e.content_data.inside_url_data.url,{inside:btoa(JSON.stringify(e.content_data))})),e.content_data.load_url=BASE_URL+n}GLOBAL_HISTORY_STATES[t]=e,setHistoryStateInfo(e),GLOBAL_CURRENT_HISTORY_STATE_NR++;var o={state:e,states:GLOBAL_HISTORY_STATES};history.pushState(o,i,a),void 0!==e.content_data&&(e.content_data.dont_load||loadHistoryState(e.content_data))}function replaceHistoryState(e){setHistoryStateInfo(e);var t="",i="";null!=e&&void 0!==e.page_title&&(t=e.page_title),null!=e&&void 0===e.page_url&&(i=e.page_url);var a={state:e,states:GLOBAL_HISTORY_STATES};history.replaceState(a,t,i)}function getHistoryStateInfo(){return GLOBAL_CURRENT_HISTORY_STATE_INFO}function getHistoryStates(){return GLOBAL_HISTORY_STATES}function setHistoryStateInfo(e){var t=null!=e&&void 0!==e.history_state_nr?e.history_state_nr:0;GLOBAL_CURRENT_HISTORY_STATE_INFO={state_nr:t,action:t>=GLOBAL_CURRENT_HISTORY_STATE_NR?"next":"back",current_state:e,old_state:void 0!==GLOBAL_HISTORY_STATES[GLOBAL_CURRENT_HISTORY_STATE_NR]?GLOBAL_HISTORY_STATES[GLOBAL_CURRENT_HISTORY_STATE_NR]:null}}function generateUrl(e,t){return angular.forEach(t,(function(t,i){e+="/"+i+"/"+t})),e}function closeHistoryStateWindow(){history.state&&($("#"+history.state.new_content_id).hide(),$("#"+history.state.old_content_id).show())}function setTabToHistory(e){var t={content_data:{tab_id:e,dont_load:!0}},i={},a=getHistoryStateInfo().current_state;$.extend(!0,i,a,t),addHistoryState(i)}function number_format(e,t,i,a){if(null==e||!isFinite(e))throw new TypeError("number is not valid");if(!t){var n=e.toString().split(".").length;t=n>1?n:0}i||(i="."),a||(a=",");var o=(e=(e=parseFloat(e).toFixed(t)).replace(".",i)).split(i);return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,a),e=o.join(i)}function multdec(e,t){return parseFloat(e*Math.pow(10,1))*parseFloat(t*Math.pow(10,1))/Math.pow(10,2)}window.onpopstate=function(e){var t=e.state,i=null!=t&&null!=t.state&&void 0!==t.state.history_state_nr?t.state.history_state_nr:0;null!=t&&null!=t.state&&(GLOBAL_HISTORY_STATES[i]=t.state),replaceHistoryState(null==t?null:t.state),GLOBAL_CURRENT_HISTORY_STATE_NR=i;var a=getHistoryStateInfo();null!=a.old_state&&void 0!==a.old_state.content_data&&void 0!==a.old_state.content_data.new_content_id&&$("#"+a.old_state.content_data.new_content_id).remove(),null!=a.current_state&&void 0!==a.current_state.content_data?void 0!==a.current_state.content_data.new_content_id&&$("#"+a.current_state.content_data.new_content_id).show():null!=a.old_state&&void 0!==a.old_state.content_data&&void 0!==a.old_state.content_data.old_content_id&&$("#"+a.old_state.content_data.old_content_id).show(),null!=t&&null!=t.state&&void 0!==t.state.content_data?loadHistoryState(t.state.content_data):angular.element(window).triggerHandler("resize"),$(document).trigger("changeHistoryState",a)},null!=history.state?(void 0!==history.state.states&&(GLOBAL_HISTORY_STATES=history.state.states),void 0!==history.state.state&&null!=history.state.state&&(GLOBAL_CURRENT_HISTORY_STATE_NR=history.state.state.history_state_nr,setHistoryStateInfo(history.state.state))):setHistoryStateInfo(null);
